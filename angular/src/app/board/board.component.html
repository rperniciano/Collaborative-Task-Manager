<div class="board-container">
  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading your board...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-danger m-4" role="alert">
      {{ error() }}
      <button class="btn btn-link" (click)="ngOnInit()">Try Again</button>
    </div>
  }

  <!-- Board View -->
  @if (board() && !loading()) {
    <div class="board-header">
      <h1 class="board-title">{{ board()!.name }}</h1>
      <div class="board-info">
        <span class="text-muted">Welcome, {{ currentUserName }}</span>
      </div>
    </div>

    <div class="columns-container">
      @for (column of columnsWithTasks(); track column.id) {
        <div class="column">
          <div class="column-header">
            <h2 class="column-title">{{ column.name }}</h2>
            <span class="task-count">{{ getTaskCount(column) }} {{ getTaskCount(column) === 1 ? 'task' : 'tasks' }}</span>
          </div>
          <div class="column-content">
            <!-- Tasks List -->
            @if (column.tasks && column.tasks.length > 0) {
              @for (task of column.tasks; track task.id) {
                <div class="task-card">
                  <div class="task-title">{{ task.title }}</div>
                  @if (task.description) {
                    <div class="task-description">{{ task.description }}</div>
                  }
                  <div class="task-meta">
                    <span class="priority-badge" [class]="getPriorityClass(task.priority)">
                      {{ getPriorityLabel(task.priority) }}
                    </span>
                    @if (task.dueDate) {
                      <span class="due-date">
                        <i class="fa fa-calendar me-1"></i>
                        {{ task.dueDate | date:'shortDate' }}
                      </span>
                    }
                    @if (task.assigneeName) {
                      <span class="assignee">
                        <i class="fa fa-user me-1"></i>
                        {{ task.assigneeName }}
                      </span>
                    }
                  </div>
                </div>
              }
            } @else {
              <!-- Empty Column Placeholder -->
              @if (showAddTaskForm() !== column.id) {
                <div class="empty-column-placeholder">
                  <p class="text-muted">Drop a task here</p>
                </div>
              }
            }

            <!-- Add Task Form (inline) -->
            @if (showAddTaskForm() === column.id) {
              <div class="add-task-form">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Enter task title..."
                  [(ngModel)]="newTaskTitle"
                  (keyup.enter)="createTask(column.id)"
                  (keyup.escape)="cancelAddTask()"
                  [disabled]="creatingTask()"
                  autofocus
                />
                <div class="add-task-actions">
                  <button
                    class="btn btn-primary btn-sm"
                    (click)="createTask(column.id)"
                    [disabled]="creatingTask() || !newTaskTitle().trim()"
                  >
                    @if (creatingTask()) {
                      <span class="spinner-border spinner-border-sm me-1"></span>
                    }
                    Add
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    (click)="cancelAddTask()"
                    [disabled]="creatingTask()"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            }
          </div>
          <div class="column-footer">
            @if (showAddTaskForm() !== column.id) {
              <button
                class="btn btn-outline-primary btn-sm add-task-btn"
                (click)="openAddTaskForm(column.id)"
              >
                <i class="fa fa-plus me-1"></i> Add task
              </button>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
